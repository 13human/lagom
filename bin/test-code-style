#! /bin/bash

. "$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )/scriptLib"

runSbt checkHeaders \
       test:checkHeaders \
       multi-jvm:checkHeaders \

runSbt validateDependencies \
       mimaCheckOneAtATime

printMessage "VALIDATE SCALA CODE FORMATTING"
bin/scalafmt --test || (
  echo "ERROR: Scalafmt test failed, see differences above."
  echo "To fix, format your sources using bin/scalafmt before submitting a pull request."
  false
)

printMessage "VALIDATE JAVA CODE FORMATTING"
runSbt javafmt
git diff --exit-code || (
  echo "[error] ERROR: javafmt check failed, see differences above."
  echo "[error] To fix, format your sources using sbt javafmt test:javafmt before submitting a pull request."
  false
)

# Only update Whitesource if WHITESOURCE_PASSWORD is defined
# Encrypted environment variables are not available to pull requests for security reasons
if [[ -n "${WHITESOURCE_PASSWORD}" ]]; then
  runSbtNoisy whitesourceUpdate
fi
